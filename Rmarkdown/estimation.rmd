```{r eval = FALSE}
# if you want to preview this file,
# 1. specify doctype: "draft" or "slide"
# 2. replace knitr format = "html"
library(here); knitr::opts_knit$set(root.dir = here())
doctype <- "draft"
options(knitr.kable.NA = " ", knitr.table.format = "html")
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  echo = FALSE,
  cache = FALSE,
  include = TRUE
)
```

# Empirical Strategy

<!--
ここらへんの議論ですが、以下の点、要検討です。これらが解決しないと残差プロットの図を出す意味は殆どないと思います。
 
 - 残差プロットの図がIntensive marginについて、期待される図とはかなり異なる結果を出しているので、どう議論しようか悩みどころです。
 - 平行トレンドについてですが、ここでは政策変更前の期間が1期しかないので、チェックできません。なので、個人的には政府の効率性の議論にかかわらず、期間を延長して分析・図を見せるのもありだと思います。とりあえずのバージョンでは平行トレンドについては書きません。
--->

```{asis, echo = doctype == "slide"}
Following @Almunia2020, we estimate giving price elasticity for intensive margin and extensive margin.

- The elasticity of intensive margin shows how much donors additionally donates reacting to the marginal increase of giving price
- The elasticity of extensive margin shows how much the probability to donate changes reacting to marginal increase of giving price.

## Elasticitiy of Intensive Margin 

$$
\ln g_{it} = \varepsilon_{INT} \ln p_{it} +g_{INT} \ln y_{it} + X_{it}\beta +\mu_i +\iota_t +u_{it}. (\#eq:intensive)
$$

- $g_{it}, p_{it}$ and $y_{it}$ respectively indicates the amount of giving, the giving price, and income of $i$ in year $t$
- $\mu_i, \iota_t$ and $u_{it}$ are individual fixed effect, year fixed effect and error term
- $X_{it}$ is a vector of covariates which include variables about education and gender. Moreover, we add some interaction terms between year fixed effect and control variables into $X_{it}$ (following @Zeldow2019).

## Elasticitiy of Extensive Margin

$$
D_{it} =  \delta \ln p_{it} +\gamma \ln y_{it} + X_{it}\beta+\mu_i  +\iota_t +v_it. \label{extensive}
$$

- $D_{it}$ is a dummy variable taking 1 if individual $i$ donates at year $t$ and 0 otherwise.
- Since we use linear probability model, $\delta = \frac{\partial D_{it}}{\partial p_{it}} p_{it}$. The extensive-margin price elasticity is $\varepsilon_{EXT} = \hat{\delta}/D_{it}$. Thus, we evaluate it at sample mean of $D_{it}$.

## Identification Strategy 

Our identification assumption is **the within price variation is exogenous**.

- This is because we use the fixed effect model to obtain elasticities.
- Our identification assumption may hold because the major *within* price variation depends on the 2014 tax reform.
    - After tax reform, the giving price is constant across individuals and there is no room for manipulation by donations and income.
    - Before tax reform (2012 and 2013), the giving price depends on (A) endogeneity of giving price and (B) simultaneous determination of income and donations. For these two reasons, the *within* price is partly endogenous.

## Obstacles for Identification

Our identification assumption may violate due to two endogenous problems under the tax deduction system.

1. Endogeneity of giving price: 
    - The tax payer can reduce their giving price by increasing their amount of donation and shifting themselves to the lower tax bracket in the tax deduction system.
    - Since this issue does not happen for the first one unit of donation, whose price ("first price") cannot be changed by adjusting the donation, we use this first price as the giving price in the estimation.

## Obstacles for Identification (Cont'd)

Our identification assumption may violate due to two endogenous problems under the tax deduction system.

2. Simultaneous determination of income and donations:
    - The change of income caused by the tax reform have effects on both donations through the income effect and the giving price through the marginal tax rate.
    - We employ lagged values of taxable income and construct an instrument variable, $\ln (p_{it}(y_{it-k} - g_{it-k})/p_{it-k}(y_{it-k} - g_{it-k}))$ where $g_{it-k} = 0$.
    - By fixing income at year $t - k$, the instrument isolates changes in price from income responses to the tax reform.
```

```{asis, echo = doctype == "draft"}
To estimate the giving price elasticity for intensive margin and extensive margin, we use DID analysis which exploit the fact that the giving price was unified in 2014 while the price was different for tax payers with different incomes.

Following @Almunia2020, we estimate the giving price elasticity for intensive margin and extensive margin. The elasticity of intensive margin shows how much donors additionally donates reacting to the marginal increase of giving price, while the elasticity of extensive margin shows how much the probability to donate changes reacting to marginal increase of giving price.

\begin{equation}
    \ln g_{it} = \varepsilon^{int}_p R_{it} \ln p_{it} + \varepsilon^{int}_y \ln y_{it} 
    + X_{it}\beta +\mu_i +\iota_t +u_{it}. (\#eq:intensive)
\end{equation}

$g_{it}, p_{it}$ and $y_{it}$ respectively indicates the amount of giving, the giving price, and income of $i$ in year $t$.
$R_{it}$ is a dummy taking one if individual $i$ applied for a tax deduction in year $t$.
$\mu_i, \iota_t$ and $u_{it}$ are individual fixed effect, year fixed effect, and the error term, respectively. 
The individual fixed effect controls for time-invariant individual characteristics. The year fixed effect controls for events that affect all subjects at the same time. $X_{it}$ is a vector of covariates that include variables about education and gender. Moreover, we add some interaction terms between year fixed effect and control variables into $X_{it}$, since they will control for events that affect subject with specific characteristics at the same time following @Zeldow2019.

On the other hand,
the elasticity of extensive margin is estimated using the linear probability model such as

\begin{equation}
D_{it} =  \delta R_{it} \ln p_{it} +\gamma \ln y_{it} + X_{it}\beta +\mu_i  +\iota_t +v_{it}. (\#eq:extensive)
\end{equation}

$D_{it}$ is a dummy variable taking 1 if individual $i$ donates at year $t$ and 0 otherwise.
Since we use the linear probability model, 
the estimated coefficient $\delta$ represents $\hat{\delta} = \frac{\partial D_{it}}{\partial p_{it}} p_{it}$.
Also, the estimated coefficient $\gamma$ represents $\hat{\gamma} = \frac{\partial D_{it}}{\partial y_{it}} y_{it}$.
Thus, the implied extensive-margin price and income elasticity are obtained by
$\hat{\delta}/\bar{D}$ and $\hat{\gamma}/\bar{D}$, respectively,
where $\bar{D}$ is sample average of outcome variable $D_{it}$.

As shown in the section \@ref(institutional-background),
the giving price $p_{it}$ is defined as follows:

\begin{align}
  p_{it}(y_{it}, g_{it}) =
  \begin{cases}
    1 - \tau_t(y_{it} - g_{it})  \quad\text{if}\quad t < 2014  \\
    1 - m \quad\text{if}\quad t \ge 2014
  \end{cases}, (\#eq:price)
\end{align}
where $\tau_t(\cdot)$ is average tax rate in year $t$.

Our identification assumption is that the *within* price variation is exogenous due to the fixed effect model.
From the equation \@ref(eq:price), 
the within price variation comes from the 2014 tax reform, the within variation of giving $g_{it}$ and income $y_{it}$.
Moreover, by the equation \@ref(eq:intensive) and \@ref(eq:extensive),
the within price variation comes from tax report $R_{it}$.
Since these three variables are self-selected,
we need to solve three potential endogeneity problems to hold our identification assumption.

As a benchmark, we estimate the equation \@ref(eq:intensive) and \@ref(eq:extensive),
assuming that $R_{it} = 1$ for all $i$ and $t$.
This means that we see individuals who did not apply for a tax deduction as those who applied for a tax deduction.
In the context of treatment effect literature,
we can see the relative price of giving as a treatment assignment.
However, individuals can choose whether to receive this treatment by appling for a tax deduction.
Although assuming $R_{it} = 1$ for all $i$ and $t$ can ignore this self-selection problem,
the estimates of price effect includes the *true* price effect and effect of self-selection of a tax deduction.
this treatment effect is sometimes called the "intention-to-treat" effect (ITT).
Later, we relax this assumption, using the instrumental variable strategy.

Next, we deal with the possibility that the giving price is endogenous because 
the taxpayer can reduce their giving price by reducing their amount of donation
and shifting themselves to the lower tax bracket in the tax deduction system.
Since this issue does not happen for the first unit of donation,
whose price ("first price") cannot be changed by adjusting the donation,
we use this first price as the giving price in the estimation.
The first price is obtained by $p^f_{it} = p_{it}(y_{it}, g_{it})$ evalueated at $g_{it} = 0$.
As long as income $y_{it}$ is exogenous, the within giving price $p^f_{it}$ is also exogenous.
Thus, assuming income $y_{it}$ is exogenous variable,
we first estimate the first-price elasticity with the equation \@ref(eq:intensive) and \@ref(eq:extensive)
which replace $\ln p_{it}$ with $\ln p^f_{it}$.
Moreover, we also estimate the last-price elasticity, using the first price $p^f_{it}$ as an instrument.

We can justify the first price method, assuming that income is exogenous.
The second approach relaxes this assumption.
Under the tax deduction system,
the change of income have effects on both donations through the income effect
and the giving price through the marginal tax rate [@Randolph1995; @Auten2002; @Bakija2011].
Therefore, following @Bakija2011,
we employ lagged values of taxable income and
construct a variable for the change in the first price of giving as following:

\begin{align}
  \Delta^k \ln p_{it} = \ln \left(\frac{p_{it}(y_{it-k} - g_{it-k})}{p_{it-k}(y_{it-k} - g_{it-k})}\right),
  (\#eq:laggedp)
\end{align}
where $g_{it-k} = 0$.
The numerator is the first price that individual $i$ would have faced in year $t$
if she had declared her year $(t - k)$ taxable income at that year. 
By fixing the income at year $t - k$, the instrument isolates changes in price from income responses to the tax reform. 
Note that this problem does not happen for the tax credit system, where the giving price is the same across all individuals.

Using this lagged variable, we estimate the $k$-th difference model formualted as follows:

\begin{align}
  \Delta^k \ln g_{it} = \varepsilon_p \Delta^k \ln p_{it} + \varepsilon_y \Delta^k \ln y_{it} 
  + \Delta^k X_{it} \beta + \mu_i + \iota_t + v_{it}, (\#eq:kdiff)
\end{align}
where $\Delta^k \ln g_{it} = \ln g_{it} - \ln g_{it-k}$,
and $\Delta^k \ln y_{it} = \ln y_{it} - \ln y_{it-k}$.
The variation of $\Delta^k \ln p_{it}$ comes from the tax reform because we fix the annual income at year $t - k$.
Therefore, we can interpret this coefficient as the giving price elasticity due to the tax reform.
Note that we do not estimate the extensive-margin elasticity because it is hard to interpret this estimation equation when we use $\Delta^k D_{it}$ as an outcome variable.
```
