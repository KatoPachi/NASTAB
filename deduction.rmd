---
title: |
  Deduction data
date: "Last updated on `r format(Sys.Date(), '%Y/%m/%d')`"
output:
  beamer_presentation:
    latex_engine: xelatex
    keep_tex: no
    toc: no
    dev: cairo_pdf
classoption: aspectratio=169
header-includes:
  - \usepackage{booktabs, threeparttable}
  - \usepackage{siunitx}
---

```{r include = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  echo = FALSE,
  cache = FALSE,
  include = TRUE,
  fig.pos = "t",
  fig.width = 10,
  fig.height = 6
)

options(
  knitr.kable.NA = "",
  modelsummary_stars_note = FALSE,
  modelsummary_factory_default = "latex"
)

library(here)
source(here("R/R6_StartAnalysis.r"))
```

## About September Data Analysis

- Donations include religious-related giving (not policital giving)
- MTR is calculated by pre-tax total income (`tinc`)
- Incentive limit is based on religious-related giving
  - 10% of total income if $t < 2014$
  - 30 million KRW if $2014 \le t < 2016$
  - 20 million KRW if $2016 \le t$

## About September Data Analysis

- Study Sample
    1. $\text{Age}\ge 24$
    2. Observed between 2010 and 2018
    3. Exclude observations with no donation and declaration
    4. Exclude pre-tax income around thresholds (2 million KRW)
    5. Exclude pre-tax income is in bracket (F) or (G)
    6. Exclude unpaid family workers, housewives, and students
    7. donation less than total income or incentive limit


## New Study Sample A

```{r echo=TRUE}
use <- StartAnalysis$new(here("data/shaped2.csv"))
```

- Current sample size: `r nrow(use$data)`
  - Taxpayers
  - Positive taxable income
  - No experience of bracket (F) and (G)
  - $\text{Age}\ge 24$
  - Observed between 2010 and 2018
  - Exclude observations with no donation and declaration
  - donation less than 10% of taxable total income

## Summary Stats

```{r}
use_summary <- use$summary()
use_summary$stats(title = "Summary of New Study Sample A", font_size = 6)
```

## Additional Sample Restriction

```{r echo=TRUE}
use2 <- use$clone(deep = TRUE)
use2$data <- subset(
  use2$data,
  family_position == 1 & work %in% c(1, 3)
)
```

- Sample size: `r nrow(use2$data)`
  - Household heads who are self-employed or full-time wage earners

## Summary Stats, Again

```{r}
use2_summary <- use2$summary()
use2_summary$stats(title = "Summary of New Study Sample B", font_size = 6)
```

# Analysis Using New Study Sample A
## Applicable and Effective Price Elasticities

```{r}
use_first <- use$first_price()
use_first$stage2(
  title = "Main Results of New Study Sample A",
  font_size = 6
)
```

## Elasticities on Declared Donations

```{r}
use_first$claimant_only(
  title = "Elasticities on Declared Donations (New Study Sample A)"
)
```

## Elasticities of Declaration

```{r}
use_first$claim_elasticity(
  title = "Elasticities of Declaration (New Study Sample A)"
)
```

## Policy Effect

```{r}
use_policy <- use$policy_effect()
use_policy$effective(
  -1.641, -1.945,
  title = "Policy Effect (New Study Sample A)",
  font_size = 5
)
```

# Analysis Using New Study Sample B
## Applicable and Effective Price Elasticities

```{r}
use2_first <- use2$first_price()
use2_first$stage2(
  title = "Main Results of New Study Sample B",
  font_size = 6
)
```

## Elasticities on Declared Donations

```{r}
use2_first$claimant_only(
  title = "Elasticities on Declared Donations (New Study Sample B)"
)
```

## Elasticities of Declaration

```{r}
use2_first$claim_elasticity(
  title = "Elasticities of Declaration (New Study Sample B)"
)
```

## Policy Effect

```{r}
use2_policy <- use2$policy_effect()
use2_policy$effective(
  -1.442, -1.238,
  title = "Policy Effect (New Study Sample B)",
  font_size = 5
)
```

# Excluding religious donation
## Summary Statistics of Donation (New Study Sample A)

```{r echo=TRUE}
use3 <- use$clone(deep = TRUE)
use3$data$donate <- with(use3$data, donate - religious_donate)
use3$data$donate_ln <- with(use3$data, log(donate))
use3$data$d_donate <- with(use3$data, ifelse(donate > 0, 1, 0))
summary(use3$data$donate)
```

## Results of New Study Sample A (1)

```{r}
use3_first <- use3$first_price()
use3_first$stage2(
  title = "Main Results of New Study Sample A",
  font_size = 6
)
```

## Results of New Study Sample A (2)

```{r}
use3_first$claimant_only(
  title = "Elasticities on Declared Donation (New Study Sample A)"
)
```

## Results of New Study Sample A (3)

```{r}
use3_first$claim_elasticity(
  title = "Elasticities of Declaration (New Study Sample A)"
)
```

## Results of New Study Sample A (4)

```{r}
use3_policy <- use3$policy_effect()
use3_policy$effective(
  -1.748, 1.494,
  title = "Policy Effect (New Study Sample A)",
  font_size = 5
)
```

## Summary Statistics of Donation (New Study Sample B)

```{r echo=TRUE}
use4 <- use2$clone(deep = TRUE)
use4$data$donate <- with(use4$data, donate - religious_donate)
use4$data$donate_ln <- with(use4$data, log(donate))
use4$data$d_donate <- with(use4$data, ifelse(donate > 0, 1, 0))
summary(use4$data$donate)
```

## Results of New Study Sample B (1)

```{r}
use4_first <- use4$first_price()
use4_first$stage2(
  title = "Main Results of New Study Sample B",
  font_size = 6
)
```

## Results of New Study Sample B (2)

```{r}
use4_first$claimant_only(
  title = "Elasticities on Declared Donations (New Study Sample B)"
)
```

## Results of New Study Sample B (3)

```{r}
use4_first$claim_elasticity(
  title = "Elasticities of Declaration (New Study Sample B)"
)
```

## Results of New Study Sample B (4)

```{r}
use4_policy <- use4$policy_effect()
use4_policy$effective(
  -1.809, 1.370,
  title = "Policy Effect (New Study Sample B)",
  font_size = 5
)
```