---
title: |
  Deduction data
date: "Last updated on `r format(Sys.Date(), '%Y/%m/%d')`"
output:
  beamer_presentation:
    latex_engine: xelatex
    keep_tex: no
    toc: no
    dev: cairo_pdf
classoption: aspectratio=169
header-includes:
  - \usepackage{booktabs, threeparttable}
  - \usepackage{siunitx}
---

```{r include = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  echo = FALSE,
  cache = FALSE,
  include = TRUE,
  fig.pos = "t",
  fig.width = 10,
  fig.height = 6
)

options(
  knitr.kable.NA = "",
  modelsummary_stars_note = FALSE,
  modelsummary_factory_default = "latex"
)

library(here)
source(here("R/R6_StartAnalysis.r"))
```

## Study Sample

```{r echo=TRUE}
use <- StartAnalysis$new(here("data/shaped2.csv"))
```

- Current sample size: `r nrow(use$data)`
  - Taxpayers
  - Positive taxable income
  - No experience of bracket (F) and (G)
  - $\text{Age}\ge 24$
  - Observed between 2010 and 2018
  - Exclude observations with no donation and declaration
  - donation less than 10% of taxable total income

## Summary Stats

```{r}
use_summary <- use$summary()
use_summary$stats(title = "Summary of Current Study Sample")
```

## Additional Condition

```{r echo=TRUE}
use2 <- use$clone(deep = TRUE)
use2$data <- subset(
  use2$data,
  family_position == 1 & work %in% c(1, 3)
)
```

- Sample size: `r nrow(use2$data)`
  - Household heads who are self-employed or full-time wage earners

## Summary Stats, Again

```{r}
use2_summary <- use2$summary()
use2_summary$stats(title = "Summary of New Study Sample")
```

# Current Study Sample

## Applicable and Effective Price Elasticities

```{r}
use_first <- use$first_price()
use_first$stage2(
  title = "Current Study Sample",
  font_size = 6
)
```

## Elasticities on Declared Donations

```{r}
use_first$claimant_only(title = "Current Study Sample")
```

## Elasticities of Declaration

```{r}
use_first$claim_elasticity(title = "Current Study Sample")
```

## Policy Effect

```{r}
use_policy <- use$policy_effect()
use_policy$effective(
  -1.641, -1.945,
  title = "Current Study Sample",
  font_size = 5
)
```

# New Study Sample

## Applicable and Effective Price Elasticities

```{r}
use2_first <- use2$first_price()
use2_first$stage2(
  title = "Main Estimaton of New Study Sample",
  font_size = 6
)
```

## Elasticities of Declared Donations

```{r}
use2_first$claimant_only(title = "New Study Sample")
```

## Elasticities of Declaration

```{r}
use2_first$claim_elasticity(title = "New Study Sample")
```

## Policy Effect

```{r}
use2_policy <- use2$policy_effect()
use2_policy$effective(
  -1.442, -1.238,
  title = "New Study Sample",
  font_size = 5
)
```

# Current Study Sample (Excluding religious donation)

## Summary Statistics of Donation

```{r echo=TRUE}
use3 <- use$clone(deep = TRUE)
use3$data$donate <- with(use3$data, donate - religious_donate)
use3$data$donate_ln <- with(use3$data, log(donate))
use3$data$d_donate <- with(use3$data, ifelse(donate > 0, 1, 0))
summary(use3$data$donate)
```

## Applicable and Effective Price Elasticities

```{r}
use3_first <- use3$first_price()
use3_first$stage2(
  title = "Current study sample excluding religious donation",
  font_size = 6
)
```

## Elasticities of Declared Donations

```{r}
use3_first$claimant_only(title = "Current study sample excluding religious donation")
```

## Elasticities of Declaration

```{r}
use3_first$claim_elasticity(title = "Current study sample excluding religious donation")
```

## Policy Effect

```{r}
use3_policy <- use3$policy_effect()
use3_policy$effective(
  -1.748, 1.494,
  title = "Current study sample excluding religious donation",
  font_size = 5
)
```

# New Study Sample (Excluding religious donation)

## Summary Statistics of Donation

```{r echo=TRUE}
use4 <- use2$clone(deep = TRUE)
use4$data$donate <- with(use4$data, donate - religious_donate)
use4$data$donate_ln <- with(use4$data, log(donate))
use4$data$d_donate <- with(use4$data, ifelse(donate > 0, 1, 0))
summary(use4$data$donate)
```

## Applicable and Effective Price Elasticities

```{r}
use4_first <- use4$first_price()
use4_first$stage2(
  title = "New study sample excluding religious donation",
  font_size = 6
)
```

## Elasticities of Declared Donations

```{r}
use4_first$claimant_only(
  title = "New study sample excluding religious donation"
)
```

## Elasticities of Declaration

```{r}
use4_first$claim_elasticity(
  title = "New study sample excluding religious donation"
)
```

## Policy Effect

```{r}
use4_policy <- use4$policy_effect()
use4_policy$effective(
  -1.809, 1.370,
  title = "New study sample excluding religious donation",
  font_size = 5
)
```